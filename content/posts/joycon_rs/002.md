---
title: "Joycon-rs ã®ä½¿ã„æ–¹ - å´é¢LED, HOMEãƒœã‚¿ãƒ³ã®ãƒ©ã‚¤ãƒˆåˆ¶å¾¡"
date: 2020-04-28T15:08:10+09:00
draft: false
tags: ["Rust", "JoyCon", "Joycon-rs", "Joycon-rs-v0.3.1", "NintendoSwitch"]
categories: ["Development", "Rust"]
---

![joycon_rs_logo](../images/joycon-rs.png)
ï¼ˆæœ¬è¨˜äº‹ã¯v0.3.1æ™‚ç‚¹ã§ã®ã‚‚ã®ã§ã‚ã‚‹ï¼‰

## TL;DR
[examples/player_lights.rs](https://github.com/KaiseiYokoyama/joycon-rs/blob/master/examples/player_lights.rs)

# Joycon-rsã‚’ä½¿ã£ã¦Joy-Conå´é¢ã®LEDã‚’åˆ¶å¾¡ã™ã‚‹
`Joycon-rs`ã‚’ç”¨ã„ã‚Œã°, *Joy-Conã®å´é¢ã«ã‚ã‚‹LEDã‚’åˆ¶å¾¡ã™ã‚‹* ã“ã¨ãŒã§ãã‚‹. 

![player_lights](../images/player_lights.gif)

Joy-Conã®ãƒ©ã‚¤ãƒˆã‚’åˆ¶å¾¡ã™ã‚‹æ©Ÿèƒ½ã®å®Ÿè£…ã¯, [`joycon_rs::joycon::lights`](https://docs.rs/joycon-rs/0.3.1/joycon_rs/joycon/lights/index.html)ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«é›†ç´„ã•ã‚Œã¦ã„ã‚‹. ä¸»è»¸ã¨ãªã‚‹ã®ã¯, [`Lights`]ãƒˆãƒ¬ã‚¤ãƒˆã§ã‚ã‚‹. ãã‚Œãã‚Œã®functionã«ã¤ã„ã¦è§£èª¬ã—ã‚ˆã†. 

ä»¥é™, Joy-Conã®å´é¢ã«ã‚ã‚‹LEDã®ã“ã¨ã‚’player lightsã¨å‘¼ç§°ã™ã‚‹. 

## [Lights::set_player_lights()](https://docs.rs/joycon-rs/0.3.1/joycon_rs/joycon/lights/trait.Lights.html#method.set_player_lights)
æ–‡å­—é€šã‚Š, player lightsã®ç‚¹ç¯çŠ¶æ…‹ã‚’ã‚»ãƒƒãƒˆã™ã‚‹. 

```rust
use joycon_rs::prelude::{*, lights::*};

// some code omitted
joycon_driver.set_player_lights(&vec![LightUp::LED0],&vec![Flash::LED2]).unwrap();
```

enumã§ã‚ã‚‹`LightUp`ãŠã‚ˆã³`Flash`ã¯ã©ã¡ã‚‰ã‚‚`LED0`~`LED3`ã®4ã¤ã®ãƒãƒªã‚¢ãƒ³ãƒˆã‚’æŒã£ã¦ã„ã‚‹. 
ãã‚Œãã‚Œã®ãƒãƒªã‚¢ãƒ³ãƒˆã¨, Joy-Conä¸Šã®player lightsã®å¯¾å¿œã¯æ¬¡ã®ã¨ãŠã‚Šã§ã‚ã‚‹. 

![joycon_player_lights](../images/joycon_player_lights.png)

ã¾ãŸ, ç‚¹ç¯ã¨ç‚¹æ»…ã®ä¸¡æ–¹ã‚’ä¸€ã¤ã®LEDã«å¯¾ã—ã¦å‘½ã˜ãŸå ´åˆ, ç‚¹ç¯ã®ã»ã†ãŒå„ªå…ˆã•ã‚Œã‚‹. 

```rust
joycon_driver.set_player_lights(&vec![LightUp::LED1], &vec![Flash::LED1]).unwrap();
```

ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨, `[SL Button] ğŸ¤”ğŸ’¡ğŸ¤”ğŸ¤” [SR Button]`ã¨ãªã‚‹. 

## [Lights::get_player_lights()](https://docs.rs/joycon-rs/0.3.1/joycon_rs/joycon/lights/trait.Lights.html#method.get_player_lights)
Joy-Conã®player lightsã®ç‚¹ç¯çŠ¶æ³ã‚’çŸ¥ã‚‹ã“ã¨ã‚‚ã§ãã‚‹. 

```rust
use joycon_rs::prelude::{*, lights::*};

let player_lights_status = joycon_driver.get_player_lights()
    .unwrap()
    .extra
    .reply;
dbg!(player_lights_status);
```

ã“ã®é–¢æ•°ã¯`JoyConResult<StandardInputReport<SubCommandReport<LightsStatus>>>`å‹ã®å€¤ã‚’è¿”ã™. 
å‹ãŒã”ã¡ã‚ƒã”ã¡ã‚ƒã—ã¦ã„ã¦åˆ†ã‹ã‚Šã¥ã‚‰ã„ãŒ, è‚å¿ƒãªã®ã¯[`LightsStatus`]ã§ã‚ã‚‹. 
ã“ã‚Œã¯`light_up`ã¨`flash`ã¨ã„ã†2ã¤ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒã£ã¦ã„ã¦ã€ãã‚Œãã‚Œç‚¹ç¯ä¸­, ç‚¹æ»…ä¸­ã®LEDã®ä¸€è¦§ã‚’è¡¨ã—ã¦ã„ã‚‹. 

`StandardInputReport<T>`å‹, `SubCommandReport<T>`å‹ã«ã¤ã„ã¦ã¯ä»Šå¾Œå–ã‚Šæ‰±ã†. 

# Joycon-rsã‚’ä½¿ã£ã¦Joy-Conã®HOMEãƒœã‚¿ãƒ³ã®ãƒ©ã‚¤ãƒˆã‚’åˆ¶å¾¡ã™ã‚‹
`Joycon-rs`ã‚’ç”¨ã„ã‚Œã°, *Joy-Conã®HOMEãƒœã‚¿ãƒ³ã®ãƒ©ã‚¤ãƒˆã‚’åˆ¶å¾¡ã™ã‚‹* ã“ã¨ãŒã§ãã‚‹. 

![home_light](../images/home_light.gif)

ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚‚[`Lights`]ãƒˆãƒ¬ã‚¤ãƒˆã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹. 

## [Lights::get_home_light()](https://docs.rs/joycon-rs/0.3.1/joycon_rs/joycon/lights/trait.Lights.html#method.set_home_light)

```rust
use joycon_rs::prelude::{*, lights::{*, home_button::*}};

let pattern =
    // loop pattern forever
    LightEmittingPattern::new(100, 0, 0u8.into())
        // 0.5 seconds to light up
        .add_phase(100,500,0)
        // 0.5 seconds to turn off
        .add_phase(0,500,0);
let player_lights_status = joycon_driver.set_home_light(&pattern);
```
[`LightEmittingPattern`]`::new()`ã®ç¬¬ä¸€å¼•æ•°ã¯, ç™ºå…‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆå°ã•ãªåŒºåˆ‡ã‚Šï¼‰ã®åŸºæº–ã¨ãªã‚‹æ™‚é–“ã§, 0~175msã§ã‚ã‚‹.  
ç¬¬äºŒå¼•æ•°ã¯ä¸€ç•ªæœ€åˆã®LEDã®ç™ºå…‰ã®å¼·ã•ã§, 0~100%ã§è¡¨ã™.  
ä¸€ç•ªæœ€å¾Œã¯ç™ºå…‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒªãƒ”ãƒ¼ãƒˆå›æ•°ã§, 0~15å›ã®ä¸­ã‹ã‚‰æŒ‡å®šã™ã‚‹. 0å›ã«ã™ã‚‹ã¨, æ–°ãŸãªç™ºå…‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŒ‡å®šã•ã‚Œã‚‹ã¾ã§åŒã˜ç™ºå…‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ°¸é ã«ç¹°ã‚Šè¿”ã™. 

[`LightEmittingPattern`]`::add_phase()`ã® *ç¬¬ä¸€å¼•æ•°* ã¯, ãã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§åˆ°é”ã™ã‚‹LEDã®ç™ºå…‰ã®å¼·ã•ã§ã‚ã‚‹. 0~100%ã§è¡¨ã™. å†…éƒ¨çš„ã«ã¯`4bit unsigned int`ã§è¡¨ã•ã‚Œã‚‹ã®ã§, ã ã„ãŸã„7%åˆ»ã¿ã§æ®µéšçš„ã«æŒ‡å®šã§ãã‚‹ã¨è€ƒãˆã¦ã»ã—ã„[^1].  
*ç¬¬äºŒå¼•æ•°* ã¯, æŒ‡å®šã—ãŸLEDã®ç™ºå…‰ã®å¼·ã•ã¾ã§ã®é·ç§»ã«ã‹ã‘ã‚‹æ™‚é–“ã§ã‚ã‚‹. ãƒŸãƒªç§’ã§æŒ‡å®šã§ãã‚‹ãŒ, ã“ã¡ã‚‰ã‚‚å†…éƒ¨çš„ã«ã¯`4bit unsigned int`ã§è¡¨ã•ã‚Œ, ãªãŠã‹ã¤[`LightEmittingPattern`]`::new()`ã®ç¬¬ä¸€å¼•æ•°ã§æŒ‡å®šã—ãŸã€ŒåŸºæº–ã¨ãªã‚‹æ™‚é–“ã€ã®å€ç‡ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹. ãã®ãŸã‚, ã€ŒåŸºæº–ã¨ãªã‚‹æ™‚é–“ã€ã¨æŒ‡å®šã—ãŸå€¤ã®çµ„ã¿åˆã‚ã›ã«ã‚ˆã£ã¦ã¯, é•ã†å€¤ã§ã‚‚`4bit unsigned int`ã«å¤‰æ›ã—ãŸã¨ãã«åŒã˜å€¤ã¨è¦‹åšã•ã‚Œ, ç™ºå…‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å·®ãŒå‡ºãªã„ã“ã¨ãŒã‚ã‚‹. 
*ç¬¬ä¸‰å¼•æ•°* ã¯, LEDã®å¼·åº¦ãŒé·ç§»ã—ã¦ç¬¬ä¸€å¼•æ•°ã§æŒ‡å®šã—ãŸç›®æ¨™å€¤ã«é”ã—ãŸã‚ã¨, ã©ã®ãã‚‰ã„ã®æ™‚é–“ãã®æ˜ã‚‹ã•ã‚’ç¶­æŒã™ã‚‹ã‹ã®æ•°å€¤ã§ã‚ã‚Š, ãƒŸãƒªç§’ã§æŒ‡å®šã§ãã‚‹. å†…éƒ¨çš„ãªè©±ã¯ç¬¬äºŒå¼•æ•°ã¨åŒä¸€ã§ã‚ã‚‹. 

ç™ºå…‰ãƒ•ã‚§ã‚¤ã‚ºã¯15å€‹ã¾ã§[`LightEmittingPattern`]ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ç™»éŒ²ã§ãã‚‹. ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚’é€šã™ã ã‘ãªã‚‰16å€‹ä»¥ä¸Šã®ç™»éŒ²ãŒå¯èƒ½ã ãŒ, Joy-Conã«ã¯é€ä¿¡ã•ã‚Œãšå‹•ä½œã«å½±éŸ¿ã—ãªã„[^2]. 

# æ¬¡å›
æ¬¡å›ã¯, Joy-Conã®ãƒã‚¤ãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆ¶å¾¡ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦è§£èª¬ã™ã‚‹. 

`Joycon-rs` v0.3.1ã®è§£èª¬è¨˜äº‹ä¸€è¦§ã¯ã“ã¡ã‚‰.  
[tags/joycon-rs-v0.3.1](/tags/joycon-rs-v0.3.1/)

[^1]: ãŸã¨ãˆã°0%ã‚’æŒ‡å®šã—ãŸã¨ãã¨1%ã‚’æŒ‡å®šã—ãŸã¨ãã§ã¯, ã©ã¡ã‚‰ã‚‚4bit unsigned intã«åœ§ç¸®ã™ã‚‹ã¨0ã«ãªã‚‹ãŸã‚é•ã„ãŒãªã„. 0%ã¨10%ã ã¨0ã¨1ã«ãªã‚‹ãŸã‚é•ã„ãŒã‚ã‚‹. 
[^2]: ã“ã®ã‚ãŸã‚Šã‚‚å‹ã‹ãƒˆãƒ¬ã‚¤ãƒˆã§åˆ¶é™ã‚’ã‹ã‘ã¦, ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãŒé€šã‚‰ãªã„ã‚ˆã†ã«ã—ãŸã»ã†ãŒã„ã„ã‚“ã ã‚ã†ã‹â€¦â€¦?
[`Lights`]: https://docs.rs/joycon-rs/0.3.1/joycon_rs/joycon/lights/trait.Lights.html
[`LightsStatus`]: https://docs.rs/joycon-rs/0.3.1/joycon_rs/joycon/lights/struct.LightsStatus.html
[`LightEmittingPattern`]: https://docs.rs/joycon-rs/0.3.1/joycon_rs/joycon/lights/home_button/struct.LightEmittingPattern.html